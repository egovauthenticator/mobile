import{F as ce,a as oe,b as se,o as ne,p as ae}from"./chunk-BCQFEIKQ.js";import{a as le}from"./chunk-QZX4LCUJ.js";import{c as de,e as ue}from"./chunk-D3BHFARY.js";import"./chunk-SUWUYGL4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AE4Q3JL3.js";import"./chunk-JPGHLKE3.js";import"./chunk-MYQ7YDYT.js";import"./chunk-BBHHHFLX.js";import"./chunk-MRNFGDTE.js";import"./chunk-NGOZEG4D.js";import"./chunk-6KTDM6DZ.js";import"./chunk-OHJQ2VB5.js";import{c as re,d as ie}from"./chunk-U3D4XQDN.js";import{$ as m,Ac as te,Cc as S,Da as E,Ea as O,Fa as R,H as c,I as n,K as _,Na as M,Ra as N,S as a,Ta as j,Ub as W,Vb as $,Wb as x,Xb as J,Yb as K,_ as l,aa as p,ac as y,cb as q,ec as X,fa as w,hb as L,ja as v,lb as d,ma as B,mb as F,na as T,nb as V,oa as U,qb as A,qc as Y,ra as P,rb as D,rc as Z,sb as z,vb as G,xb as H,yb as Q,zc as ee}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-KYGTOQGS.js";import"./chunk-FYZEVWXC.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-OJSZUQXG.js";import"./chunk-CKP3SGE2.js";import"./chunk-UAVTHAY7.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as u}from"./chunk-NS5K5CJO.js";var we=f=>({"no-shadow":f}),De=(()=>{let h=class h{constructor(t,r,e,o,i,me,pe,he,fe){var C;this.fb=t,this.authService=r,this.storageService=e,this.router=o,this.toastCtrl=i,this.loadingCtrl=me,this.platform=pe,this.scrollService=he,this.statusBarService=fe,this.showPassword=!1,this.form=this.fb.group({email:["",[d.required,d.email]],hashOtp:["",[d.required]],newPassword:[null,[d.required,d.minLength(6)]],confirmPassword:[null,[d.required,d.minLength(6)]]}),oe({eye:ne,eyeOff:ae,arrowBack:se});let g=this.router.getCurrentNavigation(),b=(C=g==null?void 0:g.extras)==null?void 0:C.state;if(console.log(b),b){let{backUrl:s,hashOtp:I,email:k}=b;(!k||!I||!s||s!=="login"&&s!=="register"&&s!=="profile"&&s!=="send-verification")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),s==="login"?this.backUrl="send-verification":this.backUrl=s,this.form.patchValue({email:k,hashOtp:I},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0});this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>u(this,null,function*(){var s;(s=this.resetPasswordSub)==null||s.unsubscribe(),this.router.navigateByUrl("/"+this.backUrl,{replaceUrl:!0})}))}ngOnInit(){this.confirmPassword.valueChanges.subscribe(t=>{t&&this.newPassword.value!==t?this.confirmPassword.setErrors({notMatching:!0}):this.confirmPassword.setErrors(null)})}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,r;(t=this.resetPasswordSub)==null||t.unsubscribe(),(r=this.backSub)==null||r.unsubscribe()}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){var t;this.statusBarService.modifyStatusBar(S.Dark),(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}onSubmit(){return u(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Saving password...",spinner:"circles"});yield t.present();let{email:r,hashOtp:e,newPassword:o}=this.form.value;this.resetPasswordSub=this.authService.resetPassword({email:r,hashOtp:e,password:o}).subscribe(i=>u(this,null,function*(){console.log("Reset password response",i.data),i.success?(yield t.dismiss(),this.showToast("Password reset successful. Please login."),this.router.navigateByUrl("/login",{replaceUrl:!0})):(yield t.dismiss(),i!=null&&i.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),i!=null&&i.message.toLowerCase().includes("please request a new otp")&&this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}}))}),i=>u(this,null,function*(){yield t.dismiss(),this.showToast((i==null?void 0:i.message)||"Reset password failed.")}))})}onForgotPassword(){return u(this,null,function*(){var r;let t=((r=this.form.controls.email)==null?void 0:r.value)||"";this.authService.forgotPassword(t).subscribe({next:()=>this.showToast("If that email exists, a reset link was sent."),error:()=>this.showToast("Unable to start reset right now.")})})}goToRegister(){this.router.navigateByUrl("/register")}onBackHandler(){let t;this.backUrl==="send-verification"?this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}}):this.router.navigate(["/"+this.backUrl],{replaceUrl:!0})}showToast(t){return u(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get hashOtp(){return this.form.get("hashOtp")}get newPassword(){return this.form.get("newPassword")}get confirmPassword(){return this.form.get("confirmPassword")}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(S.Light),this.statusBarService.overLay(!1)}};h.\u0275fac=function(r){return new(r||h)(n(G),n(ie),n(re),n(q),n(ue),n(de),n(Q),n(ce),n(le))},h.\u0275cmp=_({type:h,selectors:[["app-reset-password"]],viewQuery:function(r,e){if(r&1&&B(y,7),r&2){let o;T(o=U())&&(e.content=o.first)}},decls:25,vars:14,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],["src","assets/images/reset-password.png","alt","",2,"width","100%","height","200px","object-fit","contain"],[3,"ngSubmit","formGroup"],["formControlName","newPassword","label","New Password","placeholder","Enter your new password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["slot","end","fill","clear","size","small","type","button",3,"click"],[3,"name"],["formControlName","confirmPassword","label","Confirm Password","placeholder","Confirm your password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["expand","block","type","submit","shape","round",1,"action",3,"disabled"]],template:function(r,e){r&1&&(l(0,"ion-header",0),O(1,"async"),l(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),w("click",function(){return e.onBackHandler()}),p(5,"ion-icon",4),m()(),l(6,"ion-title",2),P(7,"Reset password"),m()()(),l(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header"),p(12,"img",8),m(),l(13,"ion-card-content")(14,"form",9),w("ngSubmit",function(){return e.onSubmit()}),l(15,"ion-input",10)(16,"ion-button",11),w("click",function(){return e.showPassword=!e.showPassword}),p(17,"ion-icon",12),m()(),p(18,"br"),l(19,"ion-input",13)(20,"ion-button",11),w("click",function(){return e.showPassword=!e.showPassword}),p(21,"ion-icon",12),m()(),p(22,"br"),l(23,"ion-button",14),P(24," Save Password "),m()()()()()()),r&2&&(a("ngClass",E(12,we,R(1,10,e.scrollService.scrollTop$)===0)),c(8),a("fullscreen",!0),c(6),a("formGroup",e.form),c(),v("errorText",e.newPassword!=null&&e.newPassword.hasError("required")?"Password is required":e.newPassword!=null&&e.newPassword.hasError("minlength")?"Password must be at least 6 characters long":""),a("type",e.showPassword?"text":"password"),c(2),a("name",e.showPassword?"eye-off":"eye"),c(2),v("errorText",e.confirmPassword!=null&&e.confirmPassword.hasError("required")?"Password is required":e.confirmPassword!=null&&e.confirmPassword.hasError("notMatching")?"Passwords do not match":""),a("type",e.showPassword?"text":"password"),c(2),a("name",e.showPassword?"eye-off":"eye"),c(2),a("disabled",e.form.invalid))},dependencies:[j,M,N,H,A,F,V,D,z,L,y,X,Y,Z,x,K,J,te,W,$,ee],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}ion-button.action[_ngcontent-%COMP%]{height:50px}"]});let f=h;return f})();export{De as ResetPasswordPage};
