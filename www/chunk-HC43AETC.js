import{a as Be}from"./chunk-QMJ2TUA6.js";import{a as Le,c as Ee,d as Ae,e as He}from"./chunk-ELRGRDWX.js";import{C as Ve,F as Re,a as Pe,c as ke,j as Oe,m as Te,y as Me}from"./chunk-BCQFEIKQ.js";import{a as je}from"./chunk-QZX4LCUJ.js";import{d as we}from"./chunk-U3D4XQDN.js";import{$ as u,Ac as Ie,Cc as w,Da as $,Ea as W,Fa as G,H as a,I as h,K as N,Na as J,P as x,Pa as X,S,Ta as Z,Ub as pe,Vb as ue,W as P,X as q,Y as Q,Z as z,_ as p,a as A,aa as m,ab as ee,ac as j,cb as te,db as ie,ea as k,ec as he,fa as I,ga as v,h as R,hb as ne,ic as de,j as H,ja as b,jc as me,k as D,ka as U,kc as fe,l as F,lc as ge,ma as T,na as M,nb as oe,oa as V,ob as re,oc as ye,pa as L,pc as _e,qb as ae,ra as f,rc as Se,sa as O,sc as E,ta as Y,ua as K,uc as ve,vc as be,w as y,wb as se,wc as Ce,x as _,xb as le,yb as ce,zc as xe}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as C}from"./chunk-NS5K5CJO.js";var Ue=["searchInput"],Ye=r=>({"no-shadow":r});function Ke(r,l){r&1&&m(0,"ion-icon",16)}function $e(r,l){r&1&&m(0,"ion-icon",16)}function We(r,l){r&1&&m(0,"ion-icon",16)}function Ge(r,l){if(r&1){let i=k();p(0,"ion-toolbar")(1,"div",13)(2,"ion-button",14),I("click",function(){y(i);let t=v();return _(t.onSelectType("psa"))}),f(3," PSA "),x(4,Ke,1,0,"ion-icon",15),u(),p(5,"ion-button",14),I("click",function(){y(i);let t=v();return _(t.onSelectType("philSys"))}),f(6," PHILSYS "),x(7,$e,1,0,"ion-icon",15),u(),p(8,"ion-button",14),I("click",function(){y(i);let t=v();return _(t.onSelectType("voters"))}),f(9," VOTERS "),x(10,We,1,0,"ion-icon",15),u()()()}if(r&2){let i=v();a(2),b("color",i.type.psa?"success":"dark"),b("fill",i.type.psa?"solid":"outline"),a(2),S("ngIf",i.type.psa),a(),b("color",i.type.philSys?"success":"dark"),b("fill",i.type.philSys?"solid":"outline"),a(2),S("ngIf",i.type.philSys),a(),b("color",i.type.voters?"success":"dark"),b("fill",i.type.voters?"solid":"outline"),a(2),S("ngIf",i.type.voters)}}function Je(r,l){if(r&1){let i=k();p(0,"ion-item",18),I("click",function(){let t=y(i).$implicit,e=v(2);return _(e.onOpenDetails(t))}),p(1,"ion-label")(2,"h2"),f(3),u(),p(4,"p"),f(5),u()(),p(6,"ion-note",19)(7,"span"),f(8),W(9,"timeAgo"),u(),m(10,"br"),p(11,"ion-text",20),f(12),u()()()}if(r&2){let i=l.$implicit;a(3),O(i==null||i.data==null?null:i.data.name),a(2),Y("",i==null?null:i.type," "),a(3),O(G(9,6,i==null?null:i.timestamp)),a(3),U("color","",i.status==="AUTHENTIC"?"primary":i.status==="ERROR"||i.status==="FAKE"?"danger":"",`
                  `),a(),O(i==null?null:i.status)}}function Xe(r,l){if(r&1&&(p(0,"span"),f(1),u(),p(2,"ion-list"),Q(3,Je,13,8,"ion-item",17,q),u()),r&2){let i=v(),n=L(9);a(),K('Search for "',n.value,'"(',i.verificationHistory.length,")"),a(2),z(i.verificationHistory)}}function Ze(r,l){r&1&&m(0,"empty-records",11)}function et(r,l){r&1&&m(0,"ion-spinner",21)}var Ct=(()=>{let l=class l{constructor(n,t,e,o,c,d,De,Fe,Ne,qe,Qe,ze){this.platform=n,this.scrollService=t,this.router=e,this.statusBarService=o,this.verificationService=c,this.authService=d,this.alertController=De,this.modalController=Fe,this.modalCtrl=Ne,this.loadingCtrl=qe,this.actionSheetController=Qe,this.route=ze,this.showShadow=!1,this.isLoading=!1,this.verificationHistory=[],this.isSearchComplete=!1,this.type={psa:!1,philSys:!1,voters:!1},this.searchSubject=new A,Pe({arrowBackOutline:ke,searchOutline:Ve,documentAttachOutline:Te,readerOutline:Me,closeOutline:Oe}),this.authService.user$.subscribe(s=>{s&&(this.currentProfile=s)}),this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>C(this,null,function*(){let s=yield this.modalCtrl.getTop(),g=yield this.actionSheetController.getTop(),B=yield this.loadingCtrl.getTop();if(s){yield s.dismiss();return}if(g){yield g.dismiss();return}if(B){yield B.dismiss();return}this.router.navigateByUrl(this.backUrl)})),this.scrollService.scrollTop$.subscribe(s=>{this.showShadow=s>0}),this.route.queryParams.subscribe(s=>{console.log("Query Params:",s);let{backUrl:g}=s;g&&(this.backUrl=g)}),this.subscription=this.searchSubject.pipe(R(1e3),H(),F(s=>{var g;return this.verificationService.getVerificationList(s.query,s.type,(g=this.currentProfile)==null?void 0:g.userId,0,9999999).pipe(D(()=>{this.isLoading=!1}))})).subscribe(s=>{this.isSearchComplete=!0,s.success&&(this.verificationHistory=s.data.results||[]),this.isLoading=!1},s=>{this.verificationHistory=[],this.isSearchComplete=!0,this.isLoading=!1})}ngOnInit(){}ngAfterViewInit(){return C(this,null,function*(){yield this.scrollService.register(this.content),setTimeout(()=>{this.searchInput.setFocus()},100)})}ionViewWillEnter(){this.initializeStatusBar(),setTimeout(()=>{this.searchInput&&this.searchInput.setFocus()},300)}ionViewWillLeave(){this.statusBarService.modifyStatusBar(w.Dark),this.onClear(),this.searchInput.value=null}ngOnDestroy(){var n,t,e;(n=this.searchSubject)==null||n.unsubscribe(),this.searchSubject=void 0,(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0,(e=this.subscription)==null||e.unsubscribe(),this.onClear(),this.searchInput.value=null}onSelectType(n){var o,c,d;this.type[n]=!this.type[n],this.isLoading=!0;let t=(d=(c=(o=this.searchInput)==null?void 0:o.value)==null?void 0:c.toString())==null?void 0:d.trim(),e=[];this.type.psa&&e.push("PSA"),this.type.philSys&&e.push("PHILSYS"),this.type.voters&&e.push("VOTERS"),this.searchSubject.next({query:t,type:e.join(",")})}onKey(n){return C(this,null,function*(){var t;try{let e=(t=n.key)==null?void 0:t.toLowerCase(),o=n.target.value.trim();if(!o){this.onClear();return}if(e==="enter"||e==="search"){this.isLoading=!0;let c=[];this.type.psa&&c.push("PSA"),this.type.philSys&&c.push("PHILSYS"),this.type.voters&&c.push("VOTERS"),this.searchSubject.next({query:o,type:c.join(",")})}}catch(e){this.isLoading=!1,this.isSearchComplete=!1,this.presentAlertMessage("Try again!",Array.isArray(e.message)?e.message[0]:e.message)}})}onInput(n){var c,d;if(!((d=(c=n==null?void 0:n.target)==null?void 0:c.value)!=null?d:"")){this.onClear();return}this.isLoading=!0;let e=n.target.value.trim(),o=[];this.type.psa&&o.push("PSA"),this.type.philSys&&o.push("PHILSYS"),this.type.voters&&o.push("VOTERS"),this.searchSubject.next({query:e,type:o.join(",")})}onClear(){this.verificationHistory=[],this.isSearchComplete=!1,this.type.psa=!1,this.type.philSys=!1,this.type.voters=!1}onOpenDetails(n){return C(this,null,function*(){let t=yield this.modalController.create({component:He,cssClass:"modal-fullscreen",backdropDismiss:!1,canDismiss:!0,componentProps:{verification:n,currentProfile:this.currentProfile}});yield t.present();let{data:e,role:o}=yield t.onDidDismiss();(o!=="ok"||!e)&&this.statusBarService.modifyStatusBar(w.Light),this.statusBarService.modifyStatusBar(w.Light),t.dismiss()})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(w.Light),this.statusBarService.overLay(!1)}presentAlertMessage(n,t){return C(this,null,function*(){yield(yield this.alertController.create({header:n,message:t,buttons:[{text:"OK",role:"cancel",cssClass:"alert-button-ok"}]})).present()})}};l.\u0275fac=function(t){return new(t||l)(h(ce),h(Re),h(te),h(je),h(Le),h(we),h(be),h(E),h(E),h(Ce),h(ve),h(ee))},l.\u0275cmp=N({type:l,selectors:[["app-search"]],viewQuery:function(t,e){if(t&1&&(T(j,7),T(Ue,5)),t&2){let o;M(o=V())&&(e.content=o.first),M(o=V())&&(e.searchInput=o.first)}},decls:15,vars:10,consts:[["searchInput",""],[3,"translucent","ngClass"],[1,"search-toolbar"],["slot","start"],["fill","clear","routerLink","/verification-history"],["slot","icon-only","name","arrow-back-outline"],[1,"search-form"],["lines","none",1,"search-pill"],["slot","start","name","search-outline"],["type","search","placeholder","Search anything...","clear-input","true","enterkeyhint","search","inputmode","search","autofocus","",3,"keyup","ionClear","ionInput","debounce"],[1,"ion-padding",3,"fullscreen"],["src","assets/icon/empty-record-placehoder.svg","title","No results found","description","Try changing or removing some filters to broaden your search."],["style","width: 100%;margin: 10px 0;",4,"ngIf"],[1,"chip-scroll","in-toolbar"],["size","small","shape","round",2,"--border-width","1px!important",3,"click","color","fill"],["slot","end","name","close-outline",4,"ngIf"],["slot","end","name","close-outline"],["button",""],["button","",3,"click"],["slot","end"],[3,"color"],[2,"width","100%","margin","10px 0"]],template:function(t,e){if(t&1){let o=k();p(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),m(4,"ion-icon",5),u()(),p(5,"form",6)(6,"ion-item",7),m(7,"ion-icon",8),p(8,"ion-input",9,0),I("keyup",function(d){return y(o),_(e.onKey(d))})("ionClear",function(){return y(o),_(e.onClear())})("ionInput",function(d){return y(o),_(e.onInput(d))}),u()()()(),x(10,Ge,11,9,"ion-toolbar"),u(),p(11,"ion-content",10),x(12,Xe,5,2)(13,Ze,1,0,"empty-records",11)(14,et,1,0,"ion-spinner",12),u()}if(t&2){let o=L(9);S("translucent",!0)("ngClass",$(8,Ye,!e.showShadow)),a(8),S("debounce",250),a(2),P(o.value?10:-1),a(),S("fullscreen",!0),a(),P(!e.isLoading&&e.verificationHistory.length>0?12:-1),a(),P(!e.isLoading&&e.isSearchComplete&&e.verificationHistory.length===0?13:-1),a(),S("ngIf",e.isLoading)}},dependencies:[j,he,Se,Z,J,X,se,ae,oe,re,le,ne,ie,pe,ue,xe,de,Ie,fe,Ee,Be,me,ge,Ae,ye,_e],styles:[".search-toolbar[_ngcontent-%COMP%]{display:flex;align-items:center;--min-height: 64px;padding-right:10px}.search-toolbar[_ngcontent-%COMP%]   .search-form[_ngcontent-%COMP%]{flex:1;display:flex}.search-toolbar[_ngcontent-%COMP%]   .search-pill[_ngcontent-%COMP%]{flex:1;--background: #ededed;--background-activated: #eceff1;--background-focused: #eceff1;--border-radius: 9999px;--min-height: 42px;--inner-padding-end: 8px;--inner-border-width: 0;margin:6px 0}.search-toolbar[_ngcontent-%COMP%]   .search-pill[_ngcontent-%COMP%]::part(native){border-radius:9999px}.search-toolbar[_ngcontent-%COMP%]   .search-pill[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{color:#9aa0a6;-webkit-margin-end:10px!important;margin-inline-end:10px!important}.search-toolbar[_ngcontent-%COMP%]   .search-pill[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]{--color: #3b3f45;--placeholder-color: #8a929a;--placeholder-opacity: 1;width:100%;font-size:15px}.search-toolbar[_ngcontent-%COMP%]   .search-pill[_ngcontent-%COMP%]   ion-input[_ngcontent-%COMP%]::part(clear-icon){color:#9aa0a6}.chip-scroll[_ngcontent-%COMP%]{display:flex;align-items:center;gap:5px;padding:8px 12px;overflow-x:auto;overflow-y:hidden;white-space:nowrap;-webkit-overflow-scrolling:touch;scroll-snap-type:x proximity;cursor:grab;-webkit-user-select:none;user-select:none;animation:_ngcontent-%COMP%_slideDown .4s ease forwards}.chip-scroll[_ngcontent-%COMP%]::-webkit-scrollbar{display:none}.chip-scroll[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:0 0 auto;--border-radius: 9999px;scroll-snap-align:start;--padding-start: 14px;--padding-end: 14px;--padding-top: 6px;--padding-bottom: 6px;font-weight:600;--box-shadow: false;box-sizing:border-box}@keyframes _ngcontent-%COMP%_slideDown{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.custom-icon[_ngcontent-%COMP%]{width:30px;height:30px;-webkit-margin-end:32px;margin-inline-end:32px;margin-top:12px;margin-bottom:12px}ion-list[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--padding-start: 0;--inner-padding-start: 0;--padding-end: 0;--inner-padding-end: 0}"]});let r=l;return r})();export{Ct as SearchPage};
