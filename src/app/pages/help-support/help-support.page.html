<ion-header>
  <ion-toolbar>
    <ion-buttons slot="start">
      <ion-button (click)="close()">
        <ion-icon name="arrow-back" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-title>Help & Support</ion-title>

    <ion-button slot="end" fill="clear" [disabled]="isAPIKeyLoading" (click)="faqModal.present()">
      <ion-icon name="help-circle" slot="icon-only"></ion-icon>
    </ion-button>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">

  <!-- Conversation -->
  <section class="chat">
    <div class="bubble" *ngFor="let m of messages" [class.user]="m.role === 'user'" [class.bot]="m.role === 'bot'"
      [class.system]="m.role === 'system'">
      <div class="who" *ngIf="m.role !== 'system'">
        <ion-icon [style]="m.role !== 'user' ? 'font-size: 1.5rem;' : 'font-size: 1rem;'"  [name]="m.role === 'user' ? 'chatbox-ellipses' : 'help-circle'" slot="icon-only" ></ion-icon>
        <span>{{ m.role === 'user' ? 'You' : 'DX OCR Assistant' }}</span>
      </div>
      <div class="text">{{ m.text }}</div>
    </div>

    <div class="typing" *ngIf="typing">
      <ion-spinner name="dots"></ion-spinner>
      <span>DX OCR Assistant is typingâ€¦</span>
    </div>
  </section>


  <ion-modal #faqModal [backdropDismiss]="true" [showBackdrop]="true" [breakpoints]="[0, 0.7, 1]"
    [initialBreakpoint]="0.8">
    <ng-template>
      <ion-header translucent="true">
        <ion-toolbar>
          <ion-buttons slot="start">
            <ion-button (click)="faqModal.dismiss()">
              <ion-icon name="close" slot="icon-only"></ion-icon>
            </ion-button>
          </ion-buttons>
          <ion-title style="text-align: center;">FAQs</ion-title>
          <div slot="end" style="width: 48px;"></div>
        </ion-toolbar>
      </ion-header>
      <ion-content class="modal-safe-botom">
        <!-- FAQ Panel (toggle) -->
        <section class="faq modal-safe-botom">
          <h2>Frequently Asked Questions</h2>
          <div class="faq-groups">
            <div class="faq-card" *ngFor="let g of faqs">
              <h3>{{ g.title }}</h3>
              <ul>
                <li *ngFor="let item of g.items">
                  <button type="button" class="faq-q" (click)="faqModal.dismiss();askFAQ(item.q)">{{ item.q }}</button>
                  <p class="faq-a">{{ item.a }}</p>
                </li>
              </ul>
            </div>
          </div>
        </section>
      </ion-content>
    </ng-template>
  </ion-modal>
</ion-content>

<ion-footer class="modal-safe-botom">
  <div class="composer">
    <input #msgInput type="text" placeholder="Type your question..." [disabled]="isAPIKeyLoading"
      [(ngModel)]="inputText" (keyup.enter)="onSend(msgInput?.value);" />
    <ion-button fill="clear" shape="round" (click)="onSend(msgInput?.value)" [disabled]="isAPIKeyLoading">
      <ion-icon slot="icon-only" size="large" name="send"></ion-icon>
    </ion-button>
  </div>
</ion-footer>
