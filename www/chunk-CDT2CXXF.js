import{F as ct,a as at,b as st}from"./chunk-BCQFEIKQ.js";import{a as lt}from"./chunk-QZX4LCUJ.js";import{c as mt,e as pt}from"./chunk-D3BHFARY.js";import"./chunk-SUWUYGL4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AE4Q3JL3.js";import"./chunk-JPGHLKE3.js";import"./chunk-MYQ7YDYT.js";import"./chunk-BBHHHFLX.js";import"./chunk-MRNFGDTE.js";import"./chunk-NGOZEG4D.js";import"./chunk-6KTDM6DZ.js";import"./chunk-OHJQ2VB5.js";import{c as rt,d as nt}from"./chunk-U3D4XQDN.js";import{$ as l,Bc as ot,Cc as w,Da as T,Ea as x,Fa as M,H as h,I as n,K as k,Na as j,P as B,Ra as E,S as f,Ta as V,Ub as q,Vb as W,W as _,Wb as $,Xb as J,Yb as K,Zb as X,_ as r,aa as g,ac as C,cb as N,ec as Y,fa as S,hb as L,lb as v,lc as Z,ma as U,mb as D,na as O,nb as F,oa as P,qb as R,qc as tt,ra as c,rb as A,rc as et,sb as z,vb as G,xb as H,yb as Q,zc as it}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-KYGTOQGS.js";import"./chunk-FYZEVWXC.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-OJSZUQXG.js";import"./chunk-CKP3SGE2.js";import"./chunk-UAVTHAY7.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as p}from"./chunk-NS5K5CJO.js";var vt=a=>({"no-shadow":a});function bt(a,s){a&1&&(r(0,"ion-note",12),c(1,"Invalid OTP"),l())}var Rt=(()=>{let s=class s{constructor(t,i,o,e,ut,dt,ht,ft,gt){var I;this.fb=t,this.authService=i,this.storageService=o,this.router=e,this.toastCtrl=ut,this.loadingCtrl=dt,this.platform=ht,this.scrollService=ft,this.statusBarService=gt,this.showPassword=!1,this.form=this.fb.group({email:["",[v.required,v.email]],otp:[null,[v.required]]}),this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>p(this,null,function*(){var m;(m=this.verifySub)==null||m.unsubscribe(),this.router.navigateByUrl("/landing-page",{replaceUrl:!0})})),at({arrowBack:st});let b=this.router.getCurrentNavigation(),y=(I=b==null?void 0:b.extras)==null?void 0:I.state;if(console.log(y),y){let{email:m,type:u,backUrl:d}=y;(!m||m.length===0||!u||u!=="verify"&&u!=="reset"||!d||d!=="login"&&d!=="register"&&d!=="profile")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),u==="reset"?this.backUrl="send-verification":this.backUrl=d,this.type=u,this.form.patchValue({email:m},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0})}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){var t;this.statusBarService.modifyStatusBar(w.Dark),(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,i;(t=this.verifySub)==null||t.unsubscribe(),(i=this.backSub)==null||i.unsubscribe()}onSubmit(){return p(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Verifying...",spinner:"circles"});yield t.present();let{email:i,otp:o}=this.form.value;this.verifySub=this.authService.verify({email:i,otp:o}).subscribe(e=>p(this,null,function*(){console.log("Verification response",e.data),yield t.dismiss(),e.success?this.type==="reset"?this.router.navigate(["/reset-password"],{replaceUrl:!0,state:{email:i,hashOtp:e.data.hashOtp,backUrl:this.backUrl}}):this.router.navigateByUrl("/login",{replaceUrl:!0}):(e!=null&&e.message.toLowerCase().includes("invalid otp")&&this.form.controls.otp.setErrors({invalidOtp:!0}),this.showToast((e==null?void 0:e.message)||"Login failed."))}),e=>p(this,null,function*(){yield t.dismiss(),this.showToast((e==null?void 0:e.message)||"Login failed.")}))})}onBackHandler(){let t={type:this.type,backUrl:null};this.type==="reset"?t.backUrl="login":t.backUrl="register",this.router.navigate(["/"+this.backUrl],{replaceUrl:!0,state:t})}goToRegister(){this.router.navigateByUrl("/register")}showToast(t){return p(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get otp(){return this.form.get("otp")}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(w.Light),this.statusBarService.overLay(!1)}};s.\u0275fac=function(i){return new(i||s)(n(G),n(nt),n(rt),n(N),n(pt),n(mt),n(Q),n(ct),n(lt))},s.\u0275cmp=k({type:s,selectors:[["app-otp"]],viewQuery:function(i,o){if(i&1&&U(C,7),i&2){let e;O(e=P())&&(o.content=e.first)}},decls:25,vars:9,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"click"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],["src","assets/images/otp.png","alt","",2,"width","100%","height","200px","object-fit","contain"],[3,"ngSubmit","formGroup"],["formControlName","otp","length","6"],["href","#"],["color","danger"],["expand","block","type","submit","shape","round",1,"action",3,"disabled"]],template:function(i,o){i&1&&(r(0,"ion-header",0),x(1,"async"),r(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),S("click",function(){return o.onBackHandler()}),g(5,"ion-icon",4),l()(),r(6,"ion-title",2),c(7,"Verify"),l()()(),r(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header"),g(12,"img",8),r(13,"ion-card-subtitle"),c(14,"Enter the 6-digit code we sent to your email to continue"),l()(),r(15,"ion-card-content")(16,"form",9),S("ngSubmit",function(){return o.onSubmit()}),r(17,"ion-input-otp",10),c(18," Didn't get a code? "),r(19,"a",11),c(20,"Resend the code"),l()(),B(21,bt,2,0,"ion-note",12),g(22,"br"),r(23,"ion-button",13),c(24," Verify "),l()()()()()()),i&2&&(f("ngClass",T(7,vt,M(1,5,o.scrollService.scrollTop$)===0)),h(8),f("fullscreen",!0),h(8),f("formGroup",o.form),h(5),_(o.otp!=null&&o.otp.hasError("invalidOtp")?21:-1),h(2),f("disabled",o.form.invalid))},dependencies:[V,j,E,H,R,D,F,A,z,L,C,Y,tt,et,$,K,X,J,q,W,it,ot,Z],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}.input-otp-description[_ngcontent-%COMP%]{font-size:1.2rem}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}ion-button.action[_ngcontent-%COMP%]{height:50px}ion-input-otp[_ngcontent-%COMP%]{--border-width: 1.5px;--border-color-focused: var(--ion-color-primary) !important;--highlight-color-focused: var(--ion-color-primary) !important;--highlight-color-valid: var(--ion-color-primary) !important}"]});let a=s;return a})();export{Rt as OtpPage};
