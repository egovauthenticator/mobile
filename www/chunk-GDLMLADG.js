import{F as ae,a as te,b as ie,o as oe,p as re}from"./chunk-BCQFEIKQ.js";import{a as ne}from"./chunk-QZX4LCUJ.js";import{c as se,e as le}from"./chunk-D3BHFARY.js";import"./chunk-SUWUYGL4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AE4Q3JL3.js";import"./chunk-JPGHLKE3.js";import"./chunk-MYQ7YDYT.js";import"./chunk-BBHHHFLX.js";import"./chunk-MRNFGDTE.js";import"./chunk-NGOZEG4D.js";import"./chunk-6KTDM6DZ.js";import"./chunk-OHJQ2VB5.js";import{c as Z,d as ee}from"./chunk-U3D4XQDN.js";import{$ as u,Ac as X,Cc as v,Da as k,Ea as _,Fa as B,H as l,I as n,K as S,Na as L,Ra as T,S as c,Ta as E,Ub as A,Vb as D,Wb as G,Xb as Q,Yb as W,_ as a,aa as m,ac as w,cb as N,db as j,ec as H,fa as f,hb as F,ja as b,lb as g,ma as I,mb as M,na as C,nb as O,oa as P,pc as Y,qb as U,qc as $,ra as h,rb as q,rc as J,sb as x,vb as V,xb as R,yb as z,zc as K}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-KYGTOQGS.js";import"./chunk-FYZEVWXC.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-OJSZUQXG.js";import"./chunk-CKP3SGE2.js";import"./chunk-UAVTHAY7.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as s}from"./chunk-NS5K5CJO.js";var pe=p=>({"no-shadow":p}),qe=(()=>{let d=class d{constructor(i,o,e,r,t,ce,ue,me,de){this.fb=i,this.authService=o,this.storageService=e,this.statusBarService=r,this.router=t,this.toastCtrl=ce,this.loadingCtrl=ue,this.platform=me,this.scrollService=de,this.showPassword=!1,this.form=this.fb.group({email:["",[g.required,g.email]],password:[null,[g.required]]}),this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>s(this,null,function*(){var y;(y=this.loginSub)==null||y.unsubscribe(),this.router.navigateByUrl("/landing-page",{replaceUrl:!0})})),te({eye:oe,eyeOff:re,arrowBack:ie})}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){var i;this.statusBarService.modifyStatusBar(v.Dark),(i=this.backSub)==null||i.unsubscribe(),this.backSub=void 0}ngOnDestroy(){var i,o;(i=this.loginSub)==null||i.unsubscribe(),(o=this.backSub)==null||o.unsubscribe()}onSubmit(){return s(this,null,function*(){var r;if((r=this.loginSub)==null||r.unsubscribe(),this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let i=yield this.loadingCtrl.create({message:"Signing in\u2026",spinner:"circles"});yield i.present();let{email:o,password:e}=this.form.value;this.loginSub=this.authService.login({email:o,password:e}).subscribe(t=>s(this,null,function*(){console.log("Login response",t.data),t.success?this.storageService.saveProfile(t.data).then(()=>s(this,null,function*(){this.authService.setCurrentLogin(t.data),yield i.dismiss(),this.router.navigateByUrl("/home",{replaceUrl:!0})})):(yield i.dismiss(),t!=null&&t.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),t!=null&&t.message.toLowerCase().includes("password incorrect")&&this.form.controls.password.setErrors({passwordIncorrect:!0}),t!=null&&t.message.toLowerCase().includes("user is not verified")&&this.router.navigate(["/otp"],{replaceUrl:!0,state:{email:o,type:"verify"}}),this.showToast((t==null?void 0:t.message)||"Login failed."))}),t=>s(this,null,function*(){yield i.dismiss(),this.showToast((t==null?void 0:t.message)||"Login failed.")}))})}onForgotPassword(){return s(this,null,function*(){this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"login"}})})}goToRegister(){this.router.navigateByUrl("/register")}showToast(i){return s(this,null,function*(){yield(yield this.toastCtrl.create({message:i,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get password(){return this.form.get("password")}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(v.Light),this.statusBarService.overLay(!1)}};d.\u0275fac=function(o){return new(o||d)(n(V),n(ee),n(Z),n(ne),n(N),n(le),n(se),n(z),n(ae))},d.\u0275cmp=S({type:d,selectors:[["app-login"]],viewQuery:function(o,e){if(o&1&&I(w,7),o&2){let r;C(r=P())&&(e.content=r.first)}},decls:27,vars:13,consts:[[3,"ngClass"],[1,"transparent-toolbar","no-shadow"],["slot","start"],["routerLink","/landing-page","fill","clear"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen","scrollEvents"],[1,"wrap"],[1,"card","no-shadow"],["src","assets/images/scan-placeholder.png","alt","",2,"width","100%","height","200px","object-fit","contain"],[3,"ngSubmit","formGroup"],["formControlName","email","label","Email","labelPlacement","stacked","fill","outline","inputmode","email","placeholder","you@example.com","clearInput","true",1,"mb",3,"errorText"],["formControlName","password","label","Password","placeholder","Enter your password","labelPlacement","stacked","fill","outline","autocomplete","off",1,"mb",3,"errorText","type"],["slot","end","fill","clear","size","small","type","button",3,"click"],[3,"name"],[2,"display","flex","flex-direction","column","align-items","flex-end","font-size","16px"],["color","primary",3,"click"],["expand","block","type","submit","shape","round",1,"action",3,"disabled"]],template:function(o,e){o&1&&(a(0,"ion-header",0),_(1,"async"),a(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),m(5,"ion-icon",4),u()(),a(6,"ion-title"),h(7,"Login"),u()()(),a(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header"),m(12,"img",8),u(),a(13,"ion-card-content")(14,"form",9),f("ngSubmit",function(){return e.onSubmit()}),m(15,"ion-input",10)(16,"br"),a(17,"ion-input",11)(18,"ion-button",12),f("click",function(){return e.showPassword=!e.showPassword}),m(19,"ion-icon",13),u()(),m(20,"br"),a(21,"div",14)(22,"ion-text",15),f("click",function(){return e.onForgotPassword()}),h(23,"Forgot password?"),u()(),m(24,"br"),a(25,"ion-button",16),h(26," Log in "),u()()()()()()),o&2&&(c("ngClass",k(11,pe,B(1,9,e.scrollService.scrollTop$)===0)),l(8),c("fullscreen",!0)("scrollEvents",!0),l(6),c("formGroup",e.form),l(),b("errorText",e.email!=null&&e.email.hasError("required")?"Email is required":e.email!=null&&e.email.hasError("userNotVerified")?"Your email is not verified. Please check your inbox.":e.email!=null&&e.email.hasError("userNotFound")?"No account found with this email":""),l(2),b("errorText",e.password!=null&&e.password.hasError("required")?"Password is required":e.password!=null&&e.password.hasError("passwordIncorrect")?"Password is incorrect":""),c("type",e.showPassword?"text":"password"),l(2),c("name",e.showPassword?"eye-off":"eye"),l(6),c("disabled",e.form.invalid))},dependencies:[E,L,T,R,U,M,O,q,x,F,j,w,H,$,J,G,W,Q,X,A,D,K,Y],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}ion-button.action[_ngcontent-%COMP%]{height:50px}"]});let p=d;return p})();export{qe as LoginPage};
