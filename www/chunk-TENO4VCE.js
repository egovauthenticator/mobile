import"./chunk-QMJ2TUA6.js";import{a as Ie,b as Me,c as ke,d as Oe,e as Ve}from"./chunk-ELRGRDWX.js";import{A as be,B as we,F as He,a as T,b as ye,h as Ce,l as ve,n as xe,r as Se}from"./chunk-BCQFEIKQ.js";import{a as Pe}from"./chunk-QZX4LCUJ.js";import{c as ge,d as _e}from"./chunk-U3D4XQDN.js";import{$ as a,Ca as F,Cc as V,Da as j,Ea as q,Fa as z,H as d,I as u,K as E,Na as N,P as w,Pa as $,S as y,Ta as Q,Ub as Y,Vb as G,W as I,Wb as J,X as L,Xb as X,Y as B,Yb as Z,Z as D,Zb as ee,_ as r,_b as te,aa as p,ac as O,db as K,ea as R,ec as ie,fa as g,ga as _,gc as ne,hb as U,hc as oe,ka as A,ma as P,mc as H,na as M,nc as re,oa as k,oc as ae,pc as se,qc as le,ra as h,rc as ce,sa as C,sc as de,uc as me,vc as ue,w as v,wc as pe,x,xb as W,xc as he,zc as fe}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as s}from"./chunk-NS5K5CJO.js";var Be=o=>({"no-shadow":o}),De=()=>({height:"70px"});function Re(o,l){o&1&&p(0,"ngx-skeleton-loader",9),o&2&&y("theme",F(1,De))}function Ae(o,l){if(o&1){let n=R();r(0,"ion-card",15)(1,"ion-button",16),g("click",function(){let e=v(n).$implicit,t=_(3);return x(t.openMenu(e))}),p(2,"ion-icon",17),a(),r(3,"ion-card-header")(4,"ion-card-title",18),g("click",function(){let e=v(n).$implicit,t=_(3);return x(t.onOpenDetails(e))}),r(5,"ion-text",19),h(6),a(),r(7,"h4",20),h(8),a()(),r(9,"ion-card-subtitle",21),g("click",function(){let e=v(n).$implicit,t=_(3);return x(t.onOpenDetails(e))}),r(10,"ion-text",22),h(11),a()()(),r(12,"ion-card-content")(13,"div",23),g("click",function(){let e=v(n).$implicit,t=_(3);return x(t.onOpenDetails(e))}),r(14,"ion-text",24),h(15),a(),r(16,"p"),h(17),q(18,"timeAgo"),a()()()()}if(o&2){let n=l.$implicit;d(5),A("color","",n.status==="AUTHENTIC"?"primary":n.status==="ERROR"||n.status==="FAKE"?"danger":"",`
                      `),d(),C(n==null?null:n.status),d(2),C(n==null||n.data==null?null:n.data.name),d(3),C(n==null?null:n.type),d(4),C(n==null||n.data==null?null:n.data.address),d(2),C(z(18,7,n==null?null:n.timestamp))}}function Fe(o,l){if(o&1&&(r(0,"div",13),B(1,Ae,19,9,"ion-card",15,L),a()),o&2){let n=_(2);d(),D(n.verificationHistory)}}function je(o,l){o&1&&(r(0,"div",14)(1,"div",25),p(2,"ion-icon",26),r(3,"h4"),h(4,"No Scanned Documents Yet"),a(),r(5,"ion-text"),h(6,"Start by scanning your first document to verify its authenticity."),a()()())}function qe(o,l){if(o&1&&w(0,Fe,3,0,"div",13)(1,je,7,0,"div",14),o&2){let n=_();I(n.verificationHistory.length>0?0:1)}}function ze(o,l){o&1&&p(0,"ion-spinner",27)}var gt=(()=>{let l=class l{constructor(i,e,t,c,f,m,S,Te,Ee,Le){this.modalCtrl=i,this.statusBarService=e,this.verificationService=t,this.storageService=c,this.authService=f,this.alertController=m,this.actionSheetController=S,this.loadingCtrl=Te,this.toastController=Ee,this.scrollService=Le,this.verificationHistory=[],this.pageIndex=0,this.pageSize=10,this.total=0,this.isLoading=!1,this.showShadow=!1,T({arrowBack:ye}),this.authService.user$.subscribe(b=>{b&&(this.currentProfile=b)}),this.scrollService.scrollTop$.subscribe(b=>{this.showShadow=b>0}),T({search:we,helpCircle:Se,scanOutline:be,cloudUploadOutline:ve,ellipsisVertical:xe,checkmarkCircleOutline:Ce})}ngOnInit(){}ngOnDestroy(){return s(this,null,function*(){var i;this.deleteSub&&((i=this.deleteSub)==null||i.unsubscribe(),this.deleteSub=void 0)})}ngAfterViewInit(){return s(this,null,function*(){this.initializeStatusBar(),yield this.scrollService.register(this.content)})}ionViewWillEnter(){this.pageIndex=0,this.verificationHistory=[],this.isLoading=!0,this.initHistory(),this.initializeStatusBar()}ionViewWillLeave(){this.statusBarService.modifyStatusBar(V.Dark)}initHistory(){return s(this,null,function*(){var i;try{this.verificationService.getVerificationList("","PSA,PHILSYS,VOTERS",(i=this.currentProfile)==null?void 0:i.userId,this.pageIndex,this.pageSize).subscribe(e=>{e.success&&(this.verificationHistory=[...this.verificationHistory,...e.data.results],this.total=e.data.total),this.isLoading=!1,this.storageService.saveProfile(this.currentProfile),this.authService.setCurrentLogin(this.currentProfile),this.refresher&&this.refresher.complete()})}catch(e){this.isLoading=!1,yield this.presentAlertMessage("Try again!",Array.isArray(e.message)?e.message[0]:e.message)}})}onOpenDetails(i){return s(this,null,function*(){let e=yield this.modalCtrl.create({component:Ve,cssClass:"modal-fullscreen",backdropDismiss:!1,canDismiss:!0,componentProps:{currentProfile:this.currentProfile,verification:i}});yield e.present(),e.onDidDismiss().then(t=>{})})}loadMore(i){return s(this,null,function*(){!this.isLoading&&this.total!==this.verificationHistory.length&&(this.isLoading=!0,this.pageIndex++,yield this.initHistory()),i.target.complete()})}handleRefresh(i){this.pageIndex=0,this.verificationHistory=[],this.isLoading=!0,this.initHistory()}openMenu(i){return s(this,null,function*(){let e=yield this.actionSheetController.create({header:"Menu",buttons:[{text:"View verification details",handler:()=>s(this,null,function*(){yield this.onOpenDetails(i),yield e.dismiss()})},{text:"Delete document request?",cssClass:"action-sheet-button-danger",handler:()=>s(this,null,function*(){let t=yield this.alertController.create({header:"Delete Request?",message:"Are you sure you want to delete this request? This action cannot be undone.",buttons:[{text:"CANCEL",role:"cancel",cssClass:"alert-button-cancel"},{text:"OK",cssClass:"alert-button-confirm",handler:()=>s(this,null,function*(){var f;(f=this.deleteSub)==null||f.unsubscribe();let c=yield this.loadingCtrl.create({message:"Processing please wait...",spinner:"circles"});yield c.present(),this.deleteSub=this.verificationService.delete(i==null?void 0:i.id).subscribe(m=>s(this,null,function*(){console.log("Delete request response",m.data),t.dismiss(),yield c.dismiss(),m.success?(this.presentToastMessage("Deleted successfully"),this.isLoading=!0,this.verificationHistory=[],this.pageIndex=0,this.initHistory()):(t.dismiss(),this.presentAlertMessage("Error updating request",(m==null?void 0:m.message)||"Failed to updated request."))}),m=>s(this,null,function*(){var S;t.dismiss(),yield c.dismiss(),this.presentAlertMessage("Error updating request",((S=m==null?void 0:m.error)==null?void 0:S.message)||"Failed to updated request.")}))})}]});yield t.present()})},{text:"Back",cssClass:"close dismiss cancel",handler:()=>s(this,null,function*(){e.dismiss()})}]});yield e.present()})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(V.Light),this.statusBarService.overLay(!1)}presentAlertMessage(i,e){return s(this,null,function*(){yield(yield this.alertController.create({header:i,message:e,buttons:[{text:"OK",role:"cancel",cssClass:"alert-button-ok"}]})).present()})}presentToastMessage(i="Success"){return s(this,null,function*(){yield(yield this.toastController.create({message:i,duration:2500,color:"success",position:"bottom",icon:"checkmark-circle-outline"})).present()})}};l.\u0275fac=function(e){return new(e||l)(u(de),u(Pe),u(Ie),u(ge),u(_e),u(ue),u(me),u(pe),u(he),u(He))},l.\u0275cmp=E({type:l,selectors:[["app-verification-history"]],viewQuery:function(e,t){if(e&1&&(P(O,7),P(H,7)),e&2){let c;M(c=k())&&(t.content=c.first),M(c=k())&&(t.refresher=c.first)}},decls:18,vars:8,consts:[[3,"translucent","ngClass"],["slot","start"],["routerLink","/home","fill","clear"],["slot","icon-only","name","arrow-back"],["slot","end"],["routerLink","/search"],["name","search","slot","icon-only"],[1,"ion-padding",3,"fullscreen"],["slot","fixed",1,"refresher-custom",3,"ionRefresh"],["count","7",3,"theme"],["threshold","120px",3,"ionInfinite","disabled"],["loadingSpinner","bubbles","loadingText","Loading more..."],["style","width: 100%;margin: 10px 0;",4,"ngIf"],[1,"verification-list"],[1,"empty-placeholder-wrapper"],["button","",1,"ion-activatable","ripple-parent"],["fill","clear","shape","round",1,"more-btn",3,"click"],["name","ellipsis-vertical","slot","icon-only"],["button","",3,"click"],[1,"status-text",3,"color"],[1,"title"],[3,"click"],[1,"subtitle"],[1,"card-content-footer",3,"click"],["color","medium"],[1,"empty-placeholder"],["src","assets/icon/empty-record-placehoder.svg"],[2,"width","100%","margin","10px 0"]],template:function(e,t){e&1&&(r(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),p(4,"ion-icon",3),a()(),r(5,"ion-title"),h(6,"Verification History"),a(),r(7,"ion-buttons",4)(8,"ion-button",5),p(9,"ion-icon",6),a()()()(),r(10,"ion-content",7)(11,"ion-refresher",8),g("ionRefresh",function(f){return t.handleRefresh(f)}),p(12,"ion-refresher-content"),a(),w(13,Re,1,2,"ngx-skeleton-loader",9)(14,qe,2,1),r(15,"ion-infinite-scroll",10),g("ionInfinite",function(f){return t.loadMore(f)}),p(16,"ion-infinite-scroll-content",11),a(),w(17,ze,1,0,"ion-spinner",12),a()),e&2&&(y("translucent",!0)("ngClass",j(6,Be,!t.showShadow)),d(10),y("fullscreen",!0),d(3),I(t.isLoading&&t.verificationHistory.length===0?13:14),d(2),y("disabled",t.total===t.verificationHistory.length||t.isLoading),d(2),y("ngIf",t.isLoading&&t.verificationHistory.length>0&&t.total!==t.verificationHistory.length))},dependencies:[Q,N,$,W,U,K,O,ie,ce,le,G,Y,fe,J,X,te,se,ke,Me,ne,oe,ae,Z,ee,Oe,H,re],styles:[".verification-list[_ngcontent-%COMP%]{display:flex;flex-direction:column;row-gap:16px}ion-card[_ngcontent-%COMP%]{box-shadow:none;background-color:#eaf2f5;border-radius:16px;margin:0!important}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]{padding-bottom:0}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   .title[_ngcontent-%COMP%]{margin:10px 0 0;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;white-space:normal;max-height:3rem}ion-card[_ngcontent-%COMP%]   ion-card-header[_ngcontent-%COMP%]   ion-card-title[_ngcontent-%COMP%]   .status-text[_ngcontent-%COMP%]{font-size:1rem}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{display:flex;flex-direction:column}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .card-content-footer[_ngcontent-%COMP%]{display:flex;flex-direction:column}ion-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]   .card-content-footer[_ngcontent-%COMP%]   ion-text[_ngcontent-%COMP%]{display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden;text-overflow:ellipsis;white-space:normal;max-height:3rem}.more-btn[_ngcontent-%COMP%]{position:absolute;top:0;right:0;z-index:2;--border-radius: 9999px;-webkit-backdrop-filter:saturate(1.2);backdrop-filter:saturate(1.2)}.empty-placeholder-wrapper[_ngcontent-%COMP%]{height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center}.empty-placeholder[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;text-align:center}.empty-placeholder[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{height:150px;width:100%}ion-footer[_ngcontent-%COMP%]{background-color:#fff}"]});let o=l;return o})();export{gt as VerificationHistoryPage};
