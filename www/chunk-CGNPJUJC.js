import{F as Me,a as we,b as Ce,g as ve,q as Se,s as ye,v as ke,w as Ie}from"./chunk-BCQFEIKQ.js";import{a as xe}from"./chunk-QZX4LCUJ.js";import{a as Oe,c as Ee,d as Ue,e as Ve}from"./chunk-D3BHFARY.js";import"./chunk-SUWUYGL4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AE4Q3JL3.js";import"./chunk-JPGHLKE3.js";import"./chunk-MYQ7YDYT.js";import"./chunk-BBHHHFLX.js";import"./chunk-MRNFGDTE.js";import"./chunk-NGOZEG4D.js";import"./chunk-6KTDM6DZ.js";import"./chunk-OHJQ2VB5.js";import{a as Pe,c as _e,d as be}from"./chunk-U3D4XQDN.js";import{$ as o,Ac as he,Ca as D,Cc as O,Da as x,Ea as R,Fa as q,H as d,I as s,K as L,Na as $,P as j,Ra as G,S as f,Sb as ne,Ta as H,Ub as ae,Vb as le,Za as Q,_ as r,aa as _,ac as M,cb as W,d as E,db as z,dc as se,ea as k,ec as ce,fa as b,g as U,ga as v,hb as K,ic as me,jc as ue,kc as pe,lb as y,ma as F,mb as Y,n as V,na as A,nb as J,oa as N,p as T,pa as S,qb as X,qc as de,ra as u,rb as Z,rc as fe,s as B,sa as I,sb as ee,vb as te,w as h,wb as ie,x as P,xb as re,yb as oe,zc as ge}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-KYGTOQGS.js";import"./chunk-FYZEVWXC.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-OJSZUQXG.js";import"./chunk-CKP3SGE2.js";import"./chunk-UAVTHAY7.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{l as p}from"./chunk-NS5K5CJO.js";var Te=(()=>{let n=class n{constructor(e){this.http=e}update(e,t){return this.http.put(`${Pe.apiBaseUrl}/user/${e}`,t).pipe(V(i=>this.log("user")),U(this.handleError("user",[])))}handleError(e="operation",t){return i=>(this.log(i.message),E(i.error))}log(e){console.log(e)}};n.\u0275fac=function(t){return new(t||n)(B(Q))},n.\u0275prov=T({token:n,factory:n.\u0275fac,providedIn:"root"});let c=n;return c})();var Be=c=>({"no-shadow":c}),qe=()=>({backUrl:"profile"});function $e(c,n){if(c&1){let a=k();r(0,"ion-header",21),R(1,"async"),r(2,"ion-toolbar")(3,"ion-buttons",3)(4,"ion-button",22),b("click",function(){h(a),v();let t=S(29);return P(t.dismiss())}),_(5,"ion-icon",23),o()(),r(6,"ion-title"),u(7,"Update profile"),o()()(),r(8,"ion-content",24)(9,"form",25),b("ngSubmit",function(){h(a);let t=v();return P(t.onSubmitUpdateProfile())}),_(10,"ion-input",26)(11,"br")(12,"ion-input",27),o()(),r(13,"ion-footer",19)(14,"ion-toolbar")(15,"div",28)(16,"ion-button",29),b("click",function(){h(a),v();let t=S(29);return P(t.dismiss())}),u(17,"Cancel"),o(),r(18,"ion-button",30),u(19,"Update"),o()()()()}if(c&2){let a=v();f("ngClass",x(7,Be,q(1,5,a.scrollService.scrollTop$)===0)),d(9),f("formGroup",a.formUpdateProfile),d(),f("errorText",a.name!=null&&a.name.hasError("required")?"Name is required":""),d(2),f("errorText",a.email!=null&&a.email.hasError("required")?"Email is required":""),d(6),f("disabled",!a.formUpdateProfile.valid||!a.formUpdateProfile.touched||!a.formUpdateProfile.dirty||a.isLoading)}}var Pt=(()=>{let n=class n{constructor(e,t,i,l,g,C,m,w,Le,je,Fe,Ae){this.fb=e,this.storageService=t,this.authService=i,this.alertController=l,this.platform=g,this.scrollService=C,this.statusBarService=m,this.userService=w,this.toastController=Le,this.loadingCtrl=je,this.modalController=Fe,this.router=Ae,this.showShadow=!1,this.formUpdateProfile=this.fb.group({name:[null,[y.required]],email:[null,[y.required,y.email]]}),this.isLoading=!1,we({arrowBack:Ce,idCardOutline:ye,personCircleOutline:Ie,helpBuoyOutline:Se,lockOpenOutline:ke,checkmarkCircle:ve}),this.scrollService.scrollTop$.subscribe(Ne=>{this.showShadow=Ne>0})}ngOnInit(){this.fillForm(),this.authService.user$.subscribe(e=>{e&&(this.currentProfile=e)})}fillForm(){this.authService.user$.subscribe(e=>{e&&(this.formUpdateProfile.setValue({name:e.name,email:e.email}),this.formUpdateProfile.markAsUntouched(),this.formUpdateProfile.markAsPristine())})}ngAfterViewInit(){return p(this,null,function*(){this.initializeStatusBar(),yield this.scrollService.register(this.content)})}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){this.statusBarService.modifyStatusBar(O.Light)}onSubmitUpdateProfile(){return p(this,null,function*(){yield(yield this.alertController.create({header:"Update profile",message:"Are you sure you want update your profile? This action cannot be undone.",buttons:[{text:"CANCEL",role:"cancel",cssClass:"alert-button-cancel"},{text:"OK",cssClass:"alert-button-confirm",handler:()=>p(this,null,function*(){var g,C;(g=this.updateSub)==null||g.unsubscribe();let t=yield this.loadingCtrl.create({message:"Saving please wait...",spinner:"circles"});yield t.present();let{name:i,email:l}=this.formUpdateProfile.value;this.updateSub=this.userService.update((C=this.currentProfile)==null?void 0:C.userId,{name:i,email:l}).subscribe(m=>p(this,null,function*(){if(console.log("Update profile response",m.data),yield t.dismiss(),m.success){this.currentProfile.name=i,this.currentProfile.email=l,this.authService.setCurrentLogin(this.currentProfile),this.storageService.saveProfile(this.currentProfile),this.formUpdateProfile.markAsPristine();let w=yield this.modalController.getTop();w&&w.dismiss(),this.presentToastMessage("Profile updated successfully")}else this.presentAlertMessage("Error updating profile",(m==null?void 0:m.message)||"Failed to updated profile.")}),m=>p(this,null,function*(){var w;yield t.dismiss(),this.presentAlertMessage("Error updating profile",((w=m==null?void 0:m.error)==null?void 0:w.message)||"Failed to updated profile.")}))})}]})).present()})}onResetPassword(){this.router.navigate(["/send-verification"],{replaceUrl:!0,state:{type:"reset",backUrl:"profile"}})}onLogout(){return p(this,null,function*(){yield(yield this.alertController.create({header:"Are you sure you want to logout?",message:"You\u2019ll be signed out from your account and need to log in again to continue.",buttons:[{text:"CANCEL",role:"cancel",cssClass:"alert-button-cancel"},{text:"Yes, Logout",cssClass:"alert-button-danger",handler:()=>p(this,null,function*(){yield this.authService.logout(),this.router.navigateByUrl("/login",{replaceUrl:!0})})}]})).present()})}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(O.Dark),this.statusBarService.overLay(!1)}presentAlertMessage(e,t){return p(this,null,function*(){yield(yield this.alertController.create({header:e,message:t,buttons:[{text:"OK",role:"cancel",cssClass:"alert-button-ok"}]})).present()})}presentToastMessage(e="Success"){return p(this,null,function*(){yield(yield this.toastController.create({message:e,duration:2500,color:"success",position:"bottom",icon:"checkmark-circle"})).present()})}get name(){return this.formUpdateProfile.get("name")}get email(){return this.formUpdateProfile.get("email")}};n.\u0275fac=function(t){return new(t||n)(s(te),s(_e),s(be),s(Oe),s(oe),s(Me),s(xe),s(Te),s(Ve),s(Ee),s(Ue),s(W))},n.\u0275cmp=L({type:n,selectors:[["app-profile"]],viewQuery:function(t,i){if(t&1&&F(M,7),t&2){let l;A(l=N())&&(i.content=l.first)}},decls:35,vars:11,consts:[["updateProfileModal",""],[3,"translucent","ngClass"],["color","primary"],["slot","start"],["routerLink","/home","fill","clear"],["slot","icon-only","name","arrow-back"],[3,"fullscreen"],[1,"profile-pic","ion-padding"],[1,"img-wrap"],["src","assets/images/avatar.png","alt",""],[1,"display-name"],[1,"email"],["lines","none",1,"settings"],["button","","detail","false",3,"click"],["name","person-circle-outline","slot","start"],["name","lock-open-outline","slot","start"],["button","","detail","false","routerLink","/help-support",3,"state"],["name","help-buoy-outline","slot","start"],[3,"willPresent","willDismiss","backdropDismiss","showBackdrop"],[1,"no-shadow","ion-padding"],["color","danger","fill","solid","shape","round","expand","block",3,"click"],["translucent","true",3,"ngClass"],[3,"click"],["name","arrow-back","slot","icon-only"],[1,"ion-padding"],["id","formUpdateProfile",3,"ngSubmit","formGroup"],["formControlName","name","label","Name","labelPlacement","stacked","fill","outline","placeholder","Enter your name","clearInput","true",1,"mb",3,"errorText"],["formControlName","email","label","Email","labelPlacement","stacked","fill","outline","placeholder","Enter your email","clearInput","true",1,"mb",3,"errorText"],[1,"action"],["shape","round","color","danger","expand","block","fill","clear",3,"click"],["shape","round","color","primary","expand","block","form","formUpdateProfile","type","submit",3,"disabled"]],template:function(t,i){if(t&1){let l=k();r(0,"ion-header",1)(1,"ion-toolbar",2)(2,"ion-buttons",3)(3,"ion-button",4),_(4,"ion-icon",5),o()(),r(5,"ion-title"),u(6,"Profile"),o()()(),r(7,"ion-content",6)(8,"div",7)(9,"div",8),_(10,"img",9),o(),r(11,"h1",10),u(12),o(),r(13,"span",11),u(14),o()(),r(15,"ion-list",12)(16,"ion-item",13),b("click",function(){h(l);let C=S(29);return P(C.present())}),_(17,"ion-icon",14),r(18,"ion-label"),u(19,"Edit profile"),o()(),r(20,"ion-item",13),b("click",function(){return h(l),P(i.onResetPassword())}),_(21,"ion-icon",15),r(22,"ion-label"),u(23,"Reset password"),o()(),r(24,"ion-item",16),_(25,"ion-icon",17),r(26,"ion-label"),u(27,"Help & Support"),o()()(),r(28,"ion-modal",18,0),b("willPresent",function(){return h(l),i.fillForm(),i.ionViewWillLeave(),P(i.formUpdateProfile.markAsPristine())})("willDismiss",function(){return h(l),P(i.ionViewWillEnter())}),j(30,$e,20,9,"ng-template"),o()(),r(31,"ion-footer",19)(32,"ion-toolbar")(33,"ion-button",20),b("click",function(){return h(l),P(i.onLogout())}),u(34," Logout "),o()()()}t&2&&(f("translucent",!0)("ngClass",x(8,Be,!i.showShadow)),d(7),f("fullscreen",!0),d(5),I((i.currentProfile==null?null:i.currentProfile.name)||""),d(2),I((i.currentProfile==null?null:i.currentProfile.email)||""),d(10),f("state",D(10,qe)),d(4),f("backdropDismiss",!0)("showBackdrop",!0))},dependencies:[M,ce,de,fe,H,$,G,ie,X,Y,J,re,Z,ee,K,z,me,ue,he,ae,le,ge,se,pe,ne],styles:[".profile-pic[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;background-color:var(--ion-color-primary);color:#fff}.profile-pic[_ngcontent-%COMP%]   .img-wrap[_ngcontent-%COMP%]{width:100px!important;height:100px!important}.profile-pic[_ngcontent-%COMP%]   .img-wrap[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:100%;border-radius:50%;object-fit:cover}.display-name[_ngcontent-%COMP%]{text-align:center}.email[_ngcontent-%COMP%]{overflow-wrap:break-word;width:100%;text-align:center}.menu[_ngcontent-%COMP%]{background-color:#fff}.settings[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: transparent;--border-width: 0;--min-height: 52px}.settings[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%] + ion-item[_ngcontent-%COMP%]{border-top:1px solid rgba(0,0,0,.06)}.settings[_ngcontent-%COMP%]   ion-icon[slot=start][_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-right:20px}ion-modal[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:46px!important;width:50%}ion-modal[_ngcontent-%COMP%]   ion-footer[_ngcontent-%COMP%]   .action[_ngcontent-%COMP%]{display:flex;flex-direction:row;gap:10px}ion-footer[_ngcontent-%COMP%]{background-color:#fff}ion-footer[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{height:50px;--box-shadow: none !important}"]});let c=n;return c})();export{Pt as ProfilePage};
