import{F as ut,a as st,b as lt}from"./chunk-BCQFEIKQ.js";import{a as ct}from"./chunk-QZX4LCUJ.js";import{c as mt,e as dt}from"./chunk-D3BHFARY.js";import"./chunk-SUWUYGL4.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AE4Q3JL3.js";import"./chunk-JPGHLKE3.js";import"./chunk-MYQ7YDYT.js";import"./chunk-BBHHHFLX.js";import"./chunk-MRNFGDTE.js";import"./chunk-NGOZEG4D.js";import"./chunk-6KTDM6DZ.js";import"./chunk-OHJQ2VB5.js";import{c as nt,d as at}from"./chunk-U3D4XQDN.js";import{$ as d,Ac as ot,Cc as y,Da as E,Ea as L,Fa as _,H as s,I as o,K as k,Na as M,Ra as F,S as m,Ta as x,Ub as J,Vb as K,Wb as X,Xb as Y,Yb as Z,_ as l,aa as f,ac as S,cb as O,db as R,ec as tt,fa as B,hb as A,ja as T,ka as P,lb as v,ma as U,mb as D,na as V,nb as q,oa as N,qb as G,qc as et,ra as b,rb as Q,rc as it,sa as j,sb as z,vb as W,xb as H,yb as $,zc as rt}from"./chunk-ZVAAHSKL.js";import"./chunk-MMD5JVTL.js";import"./chunk-OHVKLA6E.js";import"./chunk-KYGTOQGS.js";import"./chunk-FYZEVWXC.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-OJSZUQXG.js";import"./chunk-CKP3SGE2.js";import"./chunk-UAVTHAY7.js";import"./chunk-WII2C2IN.js";import"./chunk-2ZU5OH3Y.js";import"./chunk-TS4YYEKP.js";import"./chunk-LIVJLAZ7.js";import"./chunk-ZIZ6ADWA.js";import"./chunk-4U6PRYVA.js";import"./chunk-FXFZIWDD.js";import"./chunk-CSG5OQLY.js";import"./chunk-VMHM3MLJ.js";import"./chunk-3OUKC7F6.js";import"./chunk-C5RQ2IC2.js";import"./chunk-42C7ZIID.js";import{a as I,b as C,l as a}from"./chunk-NS5K5CJO.js";var vt=u=>({"no-shadow":u}),Gt=(()=>{let c=class c{constructor(t,i,r,e,pt,ft,ht,gt,bt){var w;this.fb=t,this.authService=i,this.storageService=r,this.router=e,this.toastCtrl=pt,this.loadingCtrl=ft,this.platform=ht,this.scrollService=gt,this.statusBarService=bt,this.showPassword=!1,this.form=this.fb.group({email:["",[v.required,v.email]],type:[null]}),st({arrowBack:lt});let h=this.router.getCurrentNavigation(),g=(w=h==null?void 0:h.extras)==null?void 0:w.state;if(console.log(g),g){let{backUrl:n,type:p}=g;(!p||p!=="verify"&&p!=="reset"||!n||n!=="login"&&n!=="register"&&n!=="profile")&&this.router.navigateByUrl("/login",{replaceUrl:!0}),this.backUrl=n,this.form.patchValue({type:p},{emitEvent:!1})}else this.router.navigateByUrl("/login",{replaceUrl:!0});this.backSub=this.platform.backButton.subscribeWithPriority(10,()=>a(this,null,function*(){var n;(n=this.sendVerificationSub)==null||n.unsubscribe(),this.router.navigateByUrl("/"+this.backUrl,{replaceUrl:!0})}))}ionViewWillEnter(){this.initializeStatusBar()}ionViewWillLeave(){var t;this.statusBarService.modifyStatusBar(y.Dark),(t=this.backSub)==null||t.unsubscribe(),this.backSub=void 0}ngOnInit(){}ngAfterViewInit(){this.scrollService.register(this.content)}ngOnDestroy(){var t,i;(t=this.sendVerificationSub)==null||t.unsubscribe(),(i=this.backSub)==null||i.unsubscribe()}onSubmit(){return a(this,null,function*(){if(this.form.invalid){this.form.markAllAsTouched(),this.showToast("Please fill in valid credentials.");return}let t=yield this.loadingCtrl.create({message:"Processing...",spinner:"circles"});yield t.present();let{email:i,type:r}=this.form.value;this.sendVerificationSub=this.authService.sendVerification({email:i,type:r}).subscribe(e=>a(this,null,function*(){console.log("Send verification response",e.data),e.success?(yield t.dismiss(),this.router.navigate(["/otp"],{replaceUrl:!0,state:C(I({},e.data),{type:r,backUrl:this.backUrl})})):(yield t.dismiss(),e!=null&&e.message.toLowerCase().includes("user not found")&&this.form.controls.email.setErrors({userNotFound:!0}),this.showToast((e==null?void 0:e.message)||"Login failed."))}),e=>a(this,null,function*(){yield t.dismiss(),this.showToast((e==null?void 0:e.message)||"Login failed.")}))})}onForgotPassword(){return a(this,null,function*(){var i;let t=((i=this.form.controls.email)==null?void 0:i.value)||"";this.authService.forgotPassword(t).subscribe({next:()=>this.showToast("If that email exists, a reset link was sent."),error:()=>this.showToast("Unable to start reset right now.")})})}goToRegister(){this.router.navigateByUrl("/register")}showToast(t){return a(this,null,function*(){yield(yield this.toastCtrl.create({message:t,duration:2200,position:"bottom"})).present()})}get email(){return this.form.get("email")}get type(){return this.form.get("type")}initializeStatusBar(){this.statusBarService.show(!0),this.statusBarService.modifyStatusBar(y.Light),this.statusBarService.overLay(!1)}};c.\u0275fac=function(i){return new(i||c)(o(W),o(at),o(nt),o(O),o(dt),o(mt),o($),o(ut),o(ct))},c.\u0275cmp=k({type:c,selectors:[["app-send-verification"]],viewQuery:function(i,r){if(i&1&&U(S,7),i&2){let e;V(e=N())&&(r.content=e.first)}},decls:19,vars:12,consts:[[3,"ngClass"],[1,"transparent-toolbar"],["slot","start"],["fill","clear",3,"routerLink"],["slot","icon-only","name","arrow-back"],[1,"ion-padding","page",3,"fullscreen"],[1,"wrap"],[1,"card","no-shadow"],["src","assets/images/forgot-password.png","alt","",2,"width","100%","height","200px","object-fit","contain"],[3,"ngSubmit","formGroup"],["formControlName","email","label","Email","labelPlacement","stacked","fill","outline","inputmode","email","placeholder","you@example.com","clearInput","true",1,"mb",3,"errorText"],["expand","block","type","submit","shape","round",1,"action",3,"disabled"]],template:function(i,r){i&1&&(l(0,"ion-header",0),L(1,"async"),l(2,"ion-toolbar",1)(3,"ion-buttons",2)(4,"ion-button",3),f(5,"ion-icon",4),d()(),l(6,"ion-title",2),b(7),d()()(),l(8,"ion-content",5)(9,"div",6)(10,"ion-card",7)(11,"ion-card-header"),f(12,"img",8),d(),l(13,"ion-card-content")(14,"form",9),B("ngSubmit",function(){return r.onSubmit()}),f(15,"ion-input",10)(16,"br"),l(17,"ion-button",11),b(18," Send email verification "),d()()()()()()),i&2&&(m("ngClass",E(10,vt,_(1,8,r.scrollService.scrollTop$)===0)),s(4),P("routerLink","/",r.backUrl,""),s(3),j((r.type==null?null:r.type.value)==="verfiy"?"Send email verification":"Reset password"),s(),m("fullscreen",!0),s(6),m("formGroup",r.form),s(),T("errorText",r.email!=null&&r.email.hasError("required")?"Email is required":r.email!=null&&r.email.hasError("userNotFound")?"No account found with this email":""),s(2),m("disabled",r.form.invalid))},dependencies:[x,M,F,H,G,D,q,Q,z,A,R,S,tt,et,it,X,Z,Y,ot,J,K,rt],styles:[".page[_ngcontent-%COMP%]{--background: var(--ion-color-primary-contrast)}.wrap[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center}.card[_ngcontent-%COMP%]{width:100%;max-width:400px;margin:0!important}ion-card-subtitle[_ngcontent-%COMP%]{font-size:16px!important}ion-button.action[_ngcontent-%COMP%]{height:50px}"]});let u=c;return u})();export{Gt as SendVerificationPage};
