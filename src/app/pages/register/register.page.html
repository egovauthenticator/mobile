<ion-header [ngClass]="{ 'no-shadow': (scrollService.scrollTop$ | async) === 0 }">
  <ion-toolbar class="transparent-toolbar">

    <!-- Back arrow first (left side) -->
    <ion-buttons slot="start">
      <ion-button routerLink="/landing-page" fill="clear">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
    </ion-buttons>

    <ion-title slot="start">Register</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true" class="ion-padding page">
  <div class="wrap">
    <ion-card class="card no-shadow">
      <ion-card-header>
        <img style="    width: 100%;
    height: 200px;
    object-fit: contain;" src="assets/images/register.png" alt="">
      </ion-card-header>

      <ion-card-content>
        <form [formGroup]="form" (ngSubmit)="onSubmit()">
          <!-- Name (outlined) -->
          <ion-input errorText="{{
            name?.hasError('required') ? 'Name is required' :
            name?.hasError('minlength') ? 'Name must be at least 2 characters long' :
            name?.hasError('maxlength') ? 'Name cannot be more than 50 characters long' : ''
          }}" class="mb" formControlName="name" label="Name" labelPlacement="stacked" fill="outline" inputmode="text"
            placeholder="Name" clearInput="true">
          </ion-input>

          <br>

          <!-- Email (outlined) -->
          <ion-input errorText="{{
            email?.hasError('required') ? 'Email is required' :
            email?.hasError('email') ? 'Please enter a valid email address' :
            email?.hasError('userExists') ? 'An account with this email already exists' : ''
          }}" class="mb" formControlName="email" label="Email" labelPlacement="stacked" fill="outline"
            inputmode="email" placeholder="you@example.com" clearInput="true">
          </ion-input>

          <br>

          <!-- Password (outlined) with toggle -->
          <ion-input errorText="{{
            password?.hasError('required') ? 'Password is required' :
            password?.hasError('minlength') ? 'Password must be at least 6 characters long' : ''
          }}" class="mb" formControlName="password" [type]="showPassword ? 'text' : 'password'" label="Password"
            placeholder="Enter your password" labelPlacement="stacked" fill="outline" autocomplete="off">
            <ion-button slot="end" fill="clear" size="small" type="button" (click)="showPassword = !showPassword">
              <ion-icon [name]="showPassword ? 'eye-off' : 'eye'"></ion-icon>
            </ion-button>
          </ion-input>


          <br>

          <!-- Terms + Privacy consent row -->
          <ion-checkbox aria-label="I agree to the Terms & Privacy" labelPlacement="end" formControlName="acceptTerms"
            justify="start" [checked]="form.value.acceptTerms">
            <div style="white-space: pre-line;">
              I agree to the
              <a href="#" (click)="$event.stopPropagation();openTerms($event)">Terms & Conditions</a>
              and
              <a href="#" (click)="$event.stopPropagation();openTerms($event, 'privacy')">Privacy Notice</a>
            </div>
          </ion-checkbox>

          <ion-note *ngIf="acceptTerms?.invalid && acceptTerms?.touched" color="danger">
            You must accept the Terms & Privacy to continue.
          </ion-note>

          <br>
          <ion-button class="action" expand="block" type="submit" shape="round" [disabled]="form.invalid">
            Register
          </ion-button>
        </form>
      </ion-card-content>
    </ion-card>
  </div>
  <!-- ========= TERMS & PRIVACY MODAL (single modal, contextual section jump) ========= -->
  <ion-modal [isOpen]="termsOpen" (didDismiss)="termsOpen = false" [initialBreakpoint]="1" [breakpoints]="[0, 1]">
    <ng-template>
      <ion-header>
        <ion-toolbar>
          <ion-title>Terms & Privacy</ion-title>
          <ion-buttons slot="end">
            <ion-button (click)="termsOpen = false">
              Close
            </ion-button>
          </ion-buttons>
        </ion-toolbar>
      </ion-header>

      <ion-content [fullscreen]="true" class="ion-padding terms-content">
        <!-- App / Policy Version -->
        <ion-item lines="none">
          <ion-label>
            <strong>App:</strong> E-Gov Document & ID Verification (AI OCR/QR)<br>
            <strong>Policy Version:</strong> {{ TERMS_VERSION }}<br>
            <strong>Effective:</strong> {{ TERMS_EFFECTIVE | date:'longDate' }}
          </ion-label>
        </ion-item>

        <!-- Quick summary -->
        <ion-card class="ion-margin-top">
          <ion-card-header>
            <ion-card-title>Summary</ion-card-title>
          </ion-card-header>
          <ion-card-content>
            • We verify government documents/IDs (e.g., PSA Birth Cert, PhilSys ID, Voter ID/Cert) using
            on-device/secure server AI for OCR/QR.<br>
            • You remain responsible for providing accurate/authorized documents.<br>
            • We do <em>not</em> claim affiliation with any government agency.<br>
            • Your data is handled under a privacy-by-design approach and PH Data Privacy Act (RA 10173) principles.
          </ion-card-content>
        </ion-card>

        <!-- Tabs-like anchors -->
        <div class="links">
          <a (click)="jump('#terms')">Terms</a> ·
          <a (click)="jump('#privacy')">Privacy</a> ·
          <a (click)="jump('#consent')">Consent</a>
        </div>

        <!-- TERMS -->
        <h2 id="terms">Terms & Conditions</h2>
        <ol>
          <li><strong>Service Description.</strong> This app assists with <em>document authenticity checks</em> using
            AI-based OCR/QR extraction and automated rules. Results are indicative—not a legal certification.</li>
          <li><strong>Eligibility & Authorized Use.</strong> You must be the document owner or have lawful authority to
            submit. You will not upload forged, illegal, or unauthorized materials.</li>
          <li><strong>No Government Affiliation.</strong> The app is independent and not affiliated with PSA, COMELEC,
            or any government agency.</li>
          <li><strong>Accuracy & Limitations.</strong> AI/OCR/QR may be affected by image quality, glare, crops, or
            damaged IDs. Always verify critical results with official sources.</li>
          <li><strong>Acceptable Use.</strong> No reverse engineering, automated scraping, security probing, or misuse
            (e.g., identity fraud, harassment).</li>
          <li><strong>Availability.</strong> We may update, limit, or discontinue features without notice to improve
            security and reliability.</li>
          <li><strong>Disclaimers.</strong> The service is provided “as is” and “as available.” We disclaim warranties
            to the fullest extent permitted by law.</li>
          <li><strong>Liability.</strong> To the extent allowed by law, we are not liable for indirect, incidental,
            consequential, or punitive damages.</li>
          <li><strong>Changes.</strong> We may revise these Terms; material changes will carry a new version number.
            Continued use indicates acceptance.</li>
          <li><strong>Contact.</strong> For concerns: <em>{{'your-email@example.com'}}</em></li>
        </ol>

        <!-- PRIVACY -->
        <h2 id="privacy">Privacy Notice</h2>
        <ol>
          <li><strong>Data We Process.</strong> Account data (name, email, password hash), documents/IDs you upload,
            derived text (OCR), QR payloads, logs/telemetry (timestamps, device/app versions), and verification
            outcomes.</li>
          <li><strong>Purpose.</strong> To perform document/ID verification, prevent fraud, maintain security, improve
            accuracy, and comply with legal obligations.</li>
          <li><strong>Lawful Bases.</strong> Your consent for uploads and processing; legitimate interests in fraud
            prevention, security, and app improvement; compliance where required.</li>
          <li><strong>Storage & Retention.</strong> Raw images are minimized/auto-deleted where possible; derived text
            and verification logs are retained only as needed for audit, dispute resolution, and security (define a
            period, e.g., 12–24 months).</li>
          <li><strong>Security.</strong> Encryption in transit, role-based access, least-privilege, and audit logging.
            Never share credentials. Report suspected incidents promptly.</li>
          <li><strong>Sharing.</strong> We do not sell personal data. Limited processors (cloud, analytics, email,
            storage) operate under DPAs and security standards.</li>
          <li><strong>International Transfers.</strong> If applicable, we use safeguards (e.g., SCCs) for cross-border
            processing.</li>
          <li><strong>Your Rights (RA 10173).</strong> Access, correction, deletion, withdrawal of consent, and
            complaint to the National Privacy Commission. Contact us to exercise rights.</li>
          <li><strong>Children’s Data.</strong> If minors’ IDs are processed, you confirm lawful authority
            (parent/guardian/legally authorized representative).</li>
          <li><strong>Contact DPO.</strong> <em>{{'dpo@example.com'}}</em></li>
        </ol>

        <!-- CONSENT -->
        <h2 id="consent">Consent</h2>
        <p>
          By tapping “I Agree”, you confirm you (a) have authority to submit the documents/IDs, (b) consent to OCR/QR
          extraction and automated checks, and (c) accept the Terms and this Privacy Notice (Policy Version:
          {{ TERMS_VERSION }}).
        </p>

        <ion-footer class="ion-no-border ion-padding">
          <ion-button expand="block" (click)="agreeFromModal()">
            I Agree
          </ion-button>
          <ion-button expand="block" fill="clear" (click)="termsOpen = false">
            Decline
          </ion-button>
        </ion-footer>
      </ion-content>
    </ng-template>
  </ion-modal>

</ion-content>
